<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGLC@云上中控</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            /*background-color: hwb(185 73% 8%);*/
            background:url(asset/hhfBackgroundPic.jpg);
            background-size: cover;
            background-repeat:no-repeat;
            background-attachment: fixed;

        }

        li {
            list-style: none;
        }

        h1 {
            font-size: 32px;
        }

        h4 {
            font-size: 16px;
            

            background-image: linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%);
            text-align: center;
        }

        #root {
            margin: auto;
            width: 1050px;

        }

        #title {
            text-align: center;
            width: 1050px;
            height: 70px;
            line-height: 70px;
            color: #ebebeb;
            margin: 10px auto;

        }

        .buttons{
            border-radius: 20px;           
            
        }

        #nav {
            margin: 10px auto;
            width: 1050px;

            
        }

        #nav li {
            float: left;
            width: 262.5px;
            font-size: 16px;
            line-height: 48px;
            text-align: center;

        }
        
        /* nav-bar的颜色 */
        #nav li:hover {
            color: #000000;
            /* background-color: #3f3f3f; */

            background-color: rgb(30, 123, 199);
            border-radius: 40px;
        }

        .noselect {
            color: #818181;
            background-color: #e8e7e3;
            border-radius: 40px;
        }

        .select {
            color: #000000;
            
            background-image: linear-gradient(90deg, #89f7fe 0%, #66a6ff 100%);
            border-radius: 40px;
        }

        #kongzhi,
        #shuju,
        #guiji,
        #fenxi {
            backdrop-filter: blur(10px);
            width: 1048px;
            z-index: 1;
            overflow: hidden;
            border: 1px solid #e1e1e0;
            border-top: none;
            border-radius: 40px;  
        }

        #shezhibox {
            margin: 30px auto;
            width: 230px;
            height: 110px;
            
        }

        #shezhibox span {
            display: block;
            width: 230px;
            line-height: 32px;
        }

        #textdiv {
            display: inline-block;
            width: 60px;
            line-height: 32px;
            text-align: center;
            color:white
        }

        #shezhibox input {
            text-indent: 6px;
            float: right;
            font-size: 16px;
            width: 160px;
            line-height: 28px;
            border: none;
            border-radius: 4px;
            background: #E1E1E199;
        }

        #shezhiButton {
            width: 200px;
            line-height: 32px;
            margin: 10px;
        }

        #xiuzhengButton button,
        #tiaozhuanbutton button,
        #bijiao button,
        #shedinBox button,
        #pidButton button,
        #kongzhimianban button,
        #shezhiButton button {
            width: 80px;
            line-height: 28px;
            font-size: 16px;
            margin: 0px 8px;
            background-color: #efefef;
            border-width: 0;
            box-shadow: 2px 2px 4px rgba(128, 128, 128, .5);
        }

        #xiuzhengButton button:hover,
        #tiaozhuanbutton button:hover,
        #bijiao button:hover,
        #shedinBox button:hover,
        #pidButton button:hover,
        #kongzhimianban button:hover,
        #shezhiButton button:hover {
            background-color: #e5e5e5;
        }

        #xiuzhengButton button:active,
        #tiaozhuanbutton button:active,
        #bijiao button:active,
        #shedinBox button:active,
        #pidButton button:active,
        #kongzhimianban button:active,
        #shezhiButton button:active {
            background-color: #f5f5f5;
        }

        #kongzhibox {
            width: 1000px;
            margin: 30px auto;
        }

        #kongzhimianban {
            /* background-color: yellow; */
            margin-bottom: 20px;
            float: left;
            width: 278px;
            box-shadow: 2px 2px 4px rgba(128, 128, 128, .5);
        }

        #kongzhimianban div {
            /* background-color: pink; */
            margin: 10px 20px;
            width: 238px;
        }

        #kongzhimianban button {
            width: 100px;
            margin-bottom: 10px;
        }

        #pid {
            /* background-color: green; */
            float: right;
            width: 696px;
            box-shadow: 2px 2px 4px rgba(128, 128, 128, .5);
        }

        #neihuanBox,
        #speedBox,
        #dianjiBox,
        #duojiBox {
            /* background-color: pink; */
            width: 150px;
            margin: 10px 12px;
            float: left;
        }

        #neihuanBox div,
        #tiaozhuan div,
        #speedBox div,
        #dianjiBox div,
        #duojiBox div {
            margin-bottom: 4px;
            line-height: 28px;
        }

        #neihuanBox input,
        #tiaozhuan input,
        #speedBox input,
        #dianjiBox input,
        #duojiBox input {
            text-indent: 6px;
            float: right;
            font-size: 16px;
            width: 90px;
            line-height: 28px;
            border: none;
            border-radius: 4px;
            background: #E1E1E199;
        }


        #pidButton {
            /* background-color: blue; */
            width: 150px;
            line-height: 32px;
            margin-top: 10px;
        }


        #pidButton button {
            width: 56px;
        }

        #shedin {
            float: right;
            width: 696px;
            margin: 10px auto;

            box-shadow: 2px 2px 4px rgba(128, 128, 128, .5);
        }

        #shedinBox {
            margin: 9px 20px;
            width: 150px;
            height: 32px;
            line-height: 32px;
            position: relative;
        }

        #fileButton {
            top: 0;
            left: 0;
            position: absolute;
            z-index: 0;
        }

        #subButton {
            top: 0;
            left: 96px;
            position: absolute;
        }

        #file {
            opacity: 0;
            width: 88px;
            height: 28px;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }



        #shujubox {
            margin: 10px auto;
            width: 1020px;
            height: 400px;
            color:white;
        }

        #shujubox span {

            width: 220px;
            float: left;
            font-size: 16px;
            text-align: left;
            line-height: 32px;
            margin-left: 32px;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        #shujubox span input {
            text-align: center;
            float: right;
            font-size: 16px;
            width: 60px;
            line-height: 32px;
            border: none;
            border-radius: 4px;
            background: #E1E1E199;
        }

        #turnpage {
            clear: both;
            width: 1020px;
            line-height: 30px;
            position: relative;
        }

        #bijiao {
            position: absolute;
            top: 10px;
            left: 250px;
        }

        #bijiao span {
            width: 30px;
            line-height: 30px;
        }


        #bijiao button {
            margin: 0;
            width: 30px;
            line-height: 30px;
        }

        #tiaozhuan {
            position: absolute;
            top: 18px;
            left: 450px;
            width: 180px;
            line-height: 28px;
        }

        #tiaozhuan div {
            width: 80px;
        }

        #tiaozhuanbutton {
            position: absolute;
            top: 16px;
            left: 640px;
        }

        #tiaozhuanbutton button {
            margin: 0;
            width: 60px;
            line-height: 28px;
        }

        .chaochu {
            pointer-events: none;
        }

        #xiuzhengbox {
            display: inline-block;
            margin: 30px 10px;
            margin-left: 220px;
            padding: 10px;
            width: 160px;
            height: 120px;
            box-shadow: 2px 2px 4px rgba(128, 128, 128, .5);
        }

        #xiuzhengbox span {
            display: block;
            width: 160px;
            line-height: 32px;
        }

        #xiuzhengbox #textdiv {
            width: 70px;
        }

        #xiuzhengbox input,
        #xiuzhengbox select {
            text-indent: 6px;
            float: right;
            font-size: 16px;
            width: 90px;
            height: 28px;
            line-height: 28px;
            border: none;
            border-radius: 4px;
            background: #E1E1E199;
        }

        #xiuzhengButton {
            margin-top: 5px;
        }

        #xiuzhengButton button {
            width: 60px;
            line-height: 24px;
        }


        #plot,
        #plot1,
        #plot2 {
            width: 800px;
            height: 500px;
            margin: 20px auto;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, .7);
            margin-bottom: 32px;
            box-shadow: 2px 2px 4px rgba(128, 128, 128, .5);
        }

    </style>

</head>

<body>
    
<script src="./vue.js"></script>
<script src="./axios.min.js"></script>
<script src="./echarts.min.js"></script>

<div id="root">
    <div id="title" style = "backdrop-filter: blur(6px);">
        <h1>SGLC@云上中控</h1>
    </div>

    <!-- 导航栏 -->
    <div id="nav">
        <div>
            <ul>
                <!-- 遍历navList，生成li标签-->
                <li v-for="(items,key,index) in navList" :key="key" :class="color[index]" @click="turnPage(key)" >
                    <div id="nav-box" v-text=items >
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- 远程控制 -->
    <div id="kongzhi" v-show="judge.kongzhi" >
        <div id="kongzhibox">
            <!-- 控制面板 -->
            <div id="kongzhimianban" >
                <h4>控制面板</h4>
                <!-- 创建控制面板 -->
                <div>
                    <button class="buttons" @click="openSocket">打开Socket</button>
                    <button class="buttons" @click="closeSocket">关闭Socket</button>
                    <button class="buttons" @click="start">启动</button>
                    <button class="buttons" @click="stop">停止</button>
                    <button class="buttons" @click="forward">前进</button>
                    <button class="buttons" @click="back">后退</button>
                    <button class="buttons" @click="leftforward">左前</button>
                    <button class="buttons" @click="rightforward">右前</button>
                    <button class="buttons" @click="leftback">左退</button>
                    <button class="buttons" @click="rightback">右退</button>
                    <button class="buttons" @click="analysis">分析数据</button>
                    <button class="buttons" @click="clean">清除数据</button>
                </div>
            </div>

            <!-- PID调试 -->
            <div id="pid">
                <h4>PID调试</h4>
                <div id="duojiBox">
                    <div>
                        <label for="duojiP">
                            <div id="textdiv">舵机P:</div>
                        </label>
                        <input type="text" id="duojiP" v-model="duoji.p">
                    </div>
                    <div>
                        <label for="duojiI">
                            <div id="textdiv">舵机I:</div>
                        </label>
                        <input type="text" id="duojiI" v-model="duoji.i">
                    </div>
                    <div>
                        <label for="duojiD">
                            <div id="textdiv">舵机D:</div>
                        </label>
                        <input type="text" id="duojiD" v-model="duoji.d">
                    </div>
                    <div id="pidButton">
                        <button class="buttons" @click="tiaoshi1">调试</button>
                        <button class="buttons" @click="qingkong1">清空</button>
                    </div>
                </div>

                <div id="neihuanBox">
                    <div>
                        <label for="neihuanP">
                            <div id="textdiv">内环P:</div>
                        </label>
                        <input type="text" id="neihuanP" v-model="neihuan.p">
                    </div>
                    <div>
                        <label for="neihuanI">
                            <div id="textdiv">内环I:</div>
                        </label>
                        <input type="text" id="neihuanI" v-model="neihuan.i">
                    </div>
                    <div>
                        <label for="neihuanD">
                            <div id="textdiv" >内环D:</div>
                        </label>
                        <input type="text" id="neihuanD" v-model="neihuan.d">
                    </div>
                    <div id="pidButton">
                        <button class="buttons" @click="tiaoshi4">调试</button>
                        <button class="buttons" @click="qingkong4">清空</button>
                    </div>
                </div>

                <div id="dianjiBox">
                    <div>
                        <label for="dianjiP">
                            <div id="textdiv">电机P:</div>
                        </label>
                        <input type="text" id="dianjiP" v-model="dianji.p">
                    </div>
                    <div>
                        <label for="dianjiI">
                            <div id="textdiv">电机I:</div>
                        </label>
                        <input type="text" id="dianjiI" v-model="dianji.i">
                    </div>
                    <div>
                        <label for="dianjiD">
                            <div id="textdiv">电机D:</div>
                        </label>
                        <input type="text" id="dianjiD" v-model="dianji.d">
                    </div>
                    <div id="pidButton">
                        <button class="buttons" @click="tiaoshi2">调试</button>
                        <button class="buttons" @click="qingkong2">清空</button>
                    </div>
                </div>

                <div id="speedBox">
                    <div>
                        <label for="speed">
                            <div id="textdiv">速度:</div>
                        </label>
                        <input type="text" id="speed" v-model="speednum">
                    </div>
                    <div id="pidButton">
                        <button class="buttons" @click="tiaoshi3">调试</button>
                        <button class="buttons" @click="qingkong3">清空</button>
                    </div>
                </div>
            </div>

            <!-- 按设定轨迹运动 -->
            <div id="shedin">
                <h4>按设定轨迹运动</h4>
                <div id="shedinBox">
                    <form id="txtform" action="/manage/upload" method="post"
                          enctype="multipart/form-data" target="noneIframe">
                        <button class="buttons" id="fileButton">选择文件
                            <input id="file" type="file" name="file" accept="text/plain"></input>
                        </button>
                        <button class="buttons" id="subButton" type="submit" @click="subtxt">上传</button>
                    </form>
                    <iframe name="noneIframe" style="display:none"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- 控制周期数据 -->
    <div id="shuju" v-show="judge.shuju">
        <div id="shujubox">
                <span v-for="(value,key,index) in controlData">{{name[index]+':'}}<input type="text" disabled="disabled"
                                                                                         :value="value"></span>
            <div id="turnpage">
                <div id="bijiao">
                    <span><button :class="xiao" @click="qianye" class="buttons">&lt</button></span>
                    <span> {{nowpage}}/{{totalpage}}</span>
                    <span><button :class="da" @click="houye" class="buttons">&gt</button></span>
                </div>
                <div id="tiaozhuan">
                    <label for="yeshu1">
                        <div id="textdiv">输入页数:</div>
                    </label>
                    <input type="text" id="yeshu1" v-model="topage">
                </div>
                <div id="tiaozhuanbutton">
                    <button class="buttons" @click="tiaoye">跳转</button>
                </div>

            </div>

        </div>

    </div>

    <!-- 运动轨迹 -->
    <div id="guiji" v-show="judge.guiji">
        <!-- 运动轨迹显示图 -->
        <div id="plot"></div>
        <!-- 修正轨迹 -->
        <div id="xiuzhengbox">
            <h4>修正轨迹</h4>
            <span>
                    <label for="offset_x">
                        <div id="textdiv">offset_x:</div>
                    </label>
                    <input type="text" id="offset_x" v-model="offset_x">
                </span>
            <span>
                    <label for="offset_y">
                        <div id="textdiv">offset_y:</div>
                    </label>
                    <input type="text" id="offset_y" v-model="offset_y">
                </span>
            <div id="xiuzhengButton">
                <button class="buttons" @click="shezhi">修正</button>
                <button class="buttons" @click="qingkong">清空</button>
            </div>

        </div>
        <div id="xiuzhengbox">
            <h4>选择轨迹</h4>
            <span>
                    <label for="car">
                        <div id="textdiv">车辆编号:</div>
                    </label>
                    <select name="car" id="car" @click="carmethod">
                        <option v-for="(value,index) in carlist" :value="value">{{value}}</option>
                    </select>
                </span>
            <span>
                    <label for="run">
                        <div id="textdiv">运行次数:</div>
                    </label>
                    <select name="run" id="run" @click="runmethod">
                        <option v-for=" (value,index) in runlist[this.carindex]" :value="value">{{value}}</option>
                    </select>
                </span>
            <div id="xiuzhengButton">
                <button class="buttons" @click="qingqiu">请求</button>
                <button class="buttons" @click="huoqu">获取</button>
            </div>
        </div>
    </div>

    <!-- 数据相关性分析 -->
    <div id="fenxi" v-show="judge.fenxi">
        <!-- 电感差值与舵机打角值关系图 -->
        <div id="plot1"></div>
        <!-- 电感差值与左右电机差值关系图 -->
        <div id="plot2"></div>
    </div>
</div>

<script>
    axios.defaults.baseURL = "http://47.99.136.188:8001";
    // axios.defaults.baseURL = "http://127.0.0.1:8001";// hhf 本地调试时应该改成 127.0.0.1
    Vue.config.productionTip = false;                   // hhf 减少运行时的警告语句，提高运行效率

    app = new Vue({
        el: '#root',    // DOM树为root
        data: {

            // 导航栏
            navList: {
                kongzhi: '远程控制',
                shuju: '控制周期数据',
                guiji: '运动轨迹',
                fenxi: '数据相关性分析'
            },
            // 模块显示状态
            judge: {
                kongzhi: true,
                shuju: false,
                guiji: false,
                fenxi: false
            },
            // 导航栏class
            color: ['select', 'noselect', 'noselect', 'noselect'],

            // 修正轨迹
            offset_x: '0',
            offset_y: '0',

            // 舵机PID
            duoji: {
                p: '0',
                i: '0',
                d: '0'
            },

            neihuan: {
                p: '0',
                i: '0',
                d: '0'
            },
            // 电机PID
            dianji: {
                p: '0',
                i: '0',
                d: '0'
            },
            // 目标速度
            speednum: '0',

            // 控制周期数据名
            name: ['车辆编号',
                '运行次数编号',
                '控制周期序号',
                '左轮编码器脉冲数',
                '右轮编码器脉冲数',
                '加速度计X轴读数',
                '加速度计Y轴读数',
                '加速度计Z轴读数',
                '陀螺仪X轴读数',
                '陀螺仪Y轴读数',
                '陀螺仪Z轴读数',
                '磁力计X轴读数',
                '磁力计Y轴读数',
                '磁力计Z轴读数',
                '左循迹传感器读数',
                '中循迹传感器读数',
                '右循迹传感器读数',
                '偏离赛道中心值',
                '舵机控制量',
                '左电机控制量',
                '右电机控制量',
                '左目标速度',
                '右目标速度',
                '电机控制参数P',
                '电机控制参数I',
                '电机控制参数D',
                '舵机控制参数P',
                '舵机控制参数I',
                '舵机控制参数D',
                '目标速度',
                '备用字段1',
                '备用字段2'
            ],
            // 控制周期数据
            controlData: {
                carNum: '0',
                runNum: '0',
                controlNum: '0',
                encoderL: '0',
                encodeR: '0',
                acaX: '0',
                acaY: '0',
                acaZ: '0',
                gyroX: '0',
                gyroY: '0',
                gyroZ: '0',
                magX: '0',
                magY: '0',
                magZ: '0',
                elesenorL: '0',
                elesenorM: '0',
                elesenorR: '0',
                offsetM: '0',
                servoCtrl: '0',
                motorCtrlL: '0',
                motorCtrlR: '0',
                targetEncodeL: '0',
                targetEncodeR: '0',
                motorKp: '0',
                motorKi: '0',
                motorKd: '0',
                servoKp: '0',
                servoKi: '0',
                servoKd: '0',
                speed: '0',
                str1: '0',
                str2: '0'
            },

            nowpage: '1',
            totalpage: '1',
            topage: '',
            xiao: '',
            da: '',

            car: '',
            carindex: '',
            carvalue: '',
            carlist: [0],
            run: '',
            runindex: '',
            runvalue: '',
            runlist: [
                [0]
            ],
            i: 0,
            n: 0,

            kaiguan: false,

            // 运动轨迹坐标点
            coordinate: [
                [0, 0]
            ],
            // 电感差值与舵机打角值坐标
            coordinate1: [
                [0, 0]
            ],
            // 电感差值与左右电机差值坐标
            coordinate2: [
                [0, 0]
            ],


            temp: '',
            count: 1,
            count1: 1,
            //轨迹坐标定时器
            timer: null,
            timer1: null,

            // 上传文件
            fileInput: '',

            myChart: '',
            myChart1: '',
            myChart2: '',
            option: '',
            option1: '',
            option2: ''

        },
        methods: {
            // 用于切换界面
            turnPage(key) {
                // clearInterval(this.timer);
                // clearInterval(this.timer1);
                this[key]();
            },
            qianye() {
                axios({
                    method: 'POST',
                    url: '/manage/selectCoordByPage',    //前一页接口,前台发送nowpage（显示的页数）,返回对应的控制周期数据
                    data: {
                        nowpage: --this.nowpage
                    }
                }).then(response => {
                    this.controlData = response.data[0];
                }, err => {
                    alert('控制周期数据获取失败')
                });
                if (this.nowpage > 1) {
                    this.xiao = '';
                    this.da = '';
                } else {
                    this.xiao = 'chaochu';
                    this.da = '';
                }

            },
            houye() {
                axios({
                    method: 'POST',
                    url: '/manage/selectCoordByPage',    //后一页接口,前台发送nowpage（显示的页数）,返回对应的控制周期数据
                    data: {
                        nowpage: ++this.nowpage
                    }
                }).then(response => {
                    this.controlData = response.data[0];

                }, err => {
                    alert('控制周期数据获取失败')
                })

                if (this.nowpage < this.totalpage) {
                    this.da = '';
                    this.xiao = '';
                } else {
                    this.da = 'chaochu';
                    this.xiao = '';
                }
            },
            tiaoye() {
                if (this.topage > 0 && this.topage <= this.totalpage) {
                    axios({
                        method: 'POST',
                        url: '/manage/selectCoordByToPage',    //选择页面接口,前台发送topage（设定页数）,返回对应的控制周期数据
                        data: {
                            topage: this.topage
                        }
                    }).then(response => {
                        this.controlData = response.data[0];
                        this.nowpage = this.topage;
                    }, err => {
                        alert('控制周期数据获取失败')
                    });
                } else {
                    alert('页数输入错误，取值范围应在[1,' + this.totalpage + ']');
                    this.topage = '';
                }


            },

            // 控制页面
            kongzhi() {
                this.color = ['select', 'noselect', 'noselect', 'noselect'],
                    this.judge = {
                        kongzhi: true,
                        shuju: false,
                        guiji: false,
                        fenxi: false
                    }
            },
                // 控制面板的命令
                openSocket() {
                    axios({
                        method: 'GET',
                        url: '/manage/selectCoord'     //控制周期数据接口,需返回totalpage(总页数)，controlData（最后一组控制周期数据）
                    }).then(response => {
                        alert('MySQL初始化成功')
                    }, err =>{
                        alert('MySQL初始化失败，请检查端口')
                    }),
                    axios({
                        method: 'GET',
                        url: '/manage/startSocket'     //打开socket接口
                    }).then(response => {
                        alert('打开Socket成功')
                    }, err => {
                        alert('打开Socket失败')
                    });
                },

                closeSocket() {
                    axios({
                        method: 'GET',
                        url: '/manage/stopSocket'     //关闭socket接口
                    }).then(response => {
                        alert('关闭Socket成功')
                    }, err => {
                        alert('关闭Socket失败')
                    });
                },
                start() {
                    axios({
                        method: 'GET',
                        url: '/manage/start'     //启动接口
                    }).then(response => {
                        //alert('启动成功')
                        this.kaiguan = true;
                        this.turnPage('guiji')
                    }, err => {
                        alert('启动失败')
                    });
                },
                stop() {
                    axios({
                        method: 'GET',
                        url: '/manage/stop'     //停止接口
                    }).then(response => {
                        this.kaiguan = false;
                        clearInterval(this.timer);
                        this.timer = null;
                        alert('停止成功')
                    }, err => {
                        alert('停止失败')
                    });
                },
                forward() {
                    axios({
                        method: 'GET',
                        url: '/dirction/front'     //前进接口
                    }).then(response => {
                        alert('前进成功')
                    }, err => {
                        alert('前进失败')
                    });
                },
                back() {
                    axios({
                        method: 'GET',
                        url: '/dirction/comeBack'     //后退接口
                    }).then(response => {
                        alert('后退成功')
                    }, err => {
                        alert('后退失败')
                    });
                },
                leftforward() {
                    axios({
                        method: 'GET',
                        url: '/dirction/leftFront'     //左前接口
                    }).then(response => {
                        alert('左前成功')
                    }, err => {
                        alert('左前失败')
                    });
                },
                rightforward() {
                    axios({
                        method: 'GET',
                        url: '/dirction/rightFront'     //右前接口
                    }).then(response => {
                        alert('右前成功')
                    }, err => {
                        alert('右前失败')
                    });
                },
                leftback() {
                    axios({
                        method: 'GET',
                        url: '/dirction/leftBack'     //左后接口
                    }).then(response => {
                        alert('左退成功')
                    }, err => {
                        alert('左退失败')
                    });
                },
                rightback() {
                    axios({
                        method: 'GET',
                        url: '/dirction/rightBack'     //右后接口
                    }).then(response => {
                        alert('右退成功')
                    }, err => {
                        alert('右退失败')
                    });
                },
                analysis() {
                    axios({
                        method: 'GET',
                        url: '/manage/analyse'     //分析数据接口
                    }).then(response => {
                        alert('分析数据成功')
                    }, err => {
                        alert('分析数据失败')
                    });
                },
                clean() {
                    if(confirm('你确定要删除吗？') === false){return;}// ”你确定要删除吗“弹窗
                    axios({
                        method: 'GET',
                        url: '/manage/delete'     //清除数据接口
                    }).then(response => {
                        this.coordinate = [[0,0]];
                        this.coordinate1 = [[0,0]];
                        this.coordinate2 = [[0,0]];
                        this.myChart.setOption({      // hhf：触发echart重绘，其它两个表不需要
                            series: [{data: this.coordinate}],
                        });
                        alert('清除数据成功')
                    }, err => {
                        alert('清除数据失败')
                    });
                },
                //舵机PID
                tiaoshi1() {
                    if (this.duoji.p != '' && this.duoji.i != '' && this.duoji.d != '') {
                        if (this.duoji.p <= 1000 && this.duoji.p >= 0 && this.duoji.i <= 500 && this.duoji.i >= 0 && this.duoji.d <= 500 && this.duoji.d >= 0) {
                            axios({
                                method: 'POST',
                                url: '/manage/sendPID',     //舵机PID接口
                                data: {
                                    p: this.duoji.p,
                                    i: this.duoji.i,
                                    d: this.duoji.d
                                }
                            }).then(response => {
                                alert('舵机PID调试成功');
                            }, err => {
                                alert('舵机PID调试失败');
                            })
                        } else (
                            alert('请输入有效数据,P[0,1000],I[0,500],D[0,500]'),
                                this.qingkong1()

                        )
                    } else (
                        alert('请输入有效数据,P[0,1000],I[0,500],D[0,500]'),
                            this.qingkong1()
                    )
                },
                qingkong1() {
                    this.duoji.p = '';
                    this.duoji.i = '';
                    this.duoji.d = '';
                },
                // 内环PID
                tiaoshi4() {
                    if (this.neihuan.p != '' && this.neihuan.i != '' && this.neihuan.d != '') {
                        if (this.neihuan.p <= 1000 && this.neihuan.p >= 0 && this.neihuan.i <= 500 && this.neihuan.i >= 0 && this.neihuan.d <= 500 && this.neihuan.d >= 0) {
                            axios({
                                method: 'POST',
                                url: '/manage/sendINPID',     //内环PID接口
                                data: {
                                    p: this.neihuan.p,
                                    i: this.neihuan.i,
                                    d: this.neihuan.d
                                }
                            }).then(response => {
                                alert('内环PID调试成功');
                            }, err => {
                                alert('内环PID调试失败');
                            })
                        } else (
                            alert('请输入有效数据，P[0,1000],I[0,500],D[0,500]'),
                                this.qingkong4()

                        )
                    } else (
                        alert('请输入有效数据，P[0,1000],I[0,500],D[0,500]'),
                            this.qingkong4()
                    )
                },
                qingkong4() {
                    this.neihuan.p = '';
                    this.neihuan.i = '';
                    this.neihuan.d = '';
                },
                //电机PID
                tiaoshi2() {
                    if (this.dianji.p != '' && this.dianji.i != '' && this.dianji.d != '') {
                        if (this.dianji.p <= 100 && this.dianji.p >= 0 && this.dianji.i <= 100 && this.dianji.i >= 0 && this.dianji.d <= 100 && this.dianji.d >= 0) {
                            axios({
                                method: 'POST',
                                url: '/manage/sendMPID',    //电机PID接口
                                data: {
                                    p: this.dianji.p,
                                    i: this.dianji.i,
                                    d: this.dianji.d
                                }
                            }).then(response => {
                                alert('电机PID调试成功');
                            }, err => {
                                alert('电机PID调试失败');
                            })
                        } else (
                            alert('请输入有效数据，取值范围应为[0,100]'),
                                this.qingkong2()

                        )
                    } else (
                        alert('请输入有效数据，取值范围应为[0,100]'),
                            this.qingkong2()
                    )
                },
                qingkong2() {
                    this.dianji.p = '';
                    this.dianji.i = '';
                    this.dianji.d = '';
                },
                //速度调整
                tiaoshi3() {
                    if (this.speednum != '') {
                        if (this.speednum <= 200 && this.speednum >= 0) {
                            axios({
                                method: 'POST',
                                url: '/manage/sendSP',    //速度接口
                                data: {
                                    speednum: this.speednum
                                }
                            }).then(response => {
                                alert('速度调试成功');
                            }, err => {
                                alert('速度调试失败');
                            })
                        } else (
                            alert('请输入有效数据，取值范围应为[0,200]'),
                                this.qingkong2()

                        )
                    } else (
                        alert('请输入有效数据，取值范围应为[0,200]'),
                            this.qingkong2()
                    )
                },
                qingkong3() {
                    this.speednum = '';
                },

                subtxt() {
                    this.fileInput = document.getElementById('file').value;
                    if (this.fileInput) {
                        document.getElementById("txtform").submit();
                        alert(this.fileInput + '文件上传成功');
                    } else {
                        alert("请选择上传文件");
                    }

                },

            // 数据界面
            shuju() {
                    this.color = ['noselect', 'select', 'noselect', 'noselect'],
                        this.judge = {
                            kongzhi: false,
                            shuju: true,
                            guiji: false,
                            fenxi: false
                        },

                        axios({
                            method: 'GET',
                            url: '/manage/selectCoord'     //控制周期数据接口,需返回totalpage(总页数)，controlData（最后一组控制周期数据）
                        }).then(response => {
                            this.totalpage = response.data.totalpage  //总页数形参
                            this.nowpage = response.data.totalpage  //总页数形参
                            this.controlData = response.data.controldata    //控制周期数据形参
                        }, err => {
                            alert('控制周期数据获取失败')
                        });

                    if (this.totalpage <= 1 && this.nowpage <= 1) {
                        this.da = 'chaochu';
                        this.xiao = 'chaochu';
                    } else {
                        this.da = 'chaochu';
                        this.xiao = '';
                    }
                },

            // 轨迹界面
            guiji() {
                this.color = ['noselect', 'noselect', 'select', 'noselect'];
                this.judge = {
                    kongzhi: false,
                    shuju: false,
                    guiji: true,
                    fenxi: false
                };

                // 这里有一个难以注意到的bug，在不点击停止的情况下，来回切换轨迹页面和其它页面，就会产生多个定时器！
                if (this.kaiguan && this.timer === null) {
                    // 由于当前页面要求实时更新，所以必须优化。分析页面一般用于静态显示，仍然沿用原作者的代码（仅加了非空检测）
                    this.timer = setInterval(() => {
                        axios({
                            method: 'GET',
                            url: '/manage/getXYData'     // 运动轨迹坐标点接口
                        }).then(response => {
                            if(response.data){
                                const rawCoordinate = response.data;
                                // console.log('raw');
                                // console.log(rawCoordinate);
                                const currentX = parseFloat(rawCoordinate[0].toFixed(2));
                                const currentY = parseFloat(rawCoordinate[1].toFixed(2));
                                // console.log('coors');
                                // console.log(currentX,currentY)
                                this.coordinate.push([currentX,currentY]);    // hhf：提取响应数据
                                this.myChart.setOption({                      // hhf：触发echart重绘
                                    series: [{data: this.coordinate}],
                                });
                            }
                        }, err => {
                            alert('运动轨迹获取失败');
                            clearInterval(this.timer);
                        });
                    }, 100);
                }
            },
                // 一些行为
                carmethod() {
                    this.car = document.getElementById('car');
                    this.carindex = this.car.selectedIndex;
                    this.carvalue = this.car.options[this.carindex].value;
                },
                runmethod() {
                    this.run = document.getElementById('run');
                    this.runindex = this.run.selectedIndex;
                    this.runvalue = this.run.options[this.runindex].value;
                },
                // 几个按钮
                shezhi() {
                    axios({
                        method: 'POST',
                        url: '/manage/sendOffset',    //offset接口,其实原作者根本为这个接口实现任何实际功能，就返回了一句success
                        data: {
                            offset_x: this.offset_x,
                            offset_y: this.offset_y
                        }
                    }).then(response => {
                        alert('修正成功');
                        this.coordinate = response.data;
                        this.myChart();

                    }, err => {
                        alert('修正失败');
                    })
                },
                qingkong() {
                    this.offset_x = '0';
                    this.offset_y = '0';
                },
                qingqiu() {
                    this.carlist = [];
                    this.runlist = [];
                    axios({
                        method: 'GET',
                        url: '/manage/getNumAndId',    //请求接口,返回轨迹的小车编号和对应的运行次数
                    }).then(response => {
                        alert('请求成功');
                        for (prop in response.data) {
                            this.carlist.push(prop);
                            this.runlist.push(response.data[prop]);
                        }

                    }, err => {
                        alert('请求失败');
                    })
                },
                huoqu() {
                axios({
                    method: 'POST',
                    url: '/manage/updateCoordinate',    //获取接口,前台发送车辆编号和运行次数，返回对应的运行轨迹
                    data: {
                        carvalue: this.carvalue,
                        runvalue: this.runvalue
                    }
                }).then(response => {
                    alert('获取成功');
                    this.coordinate = response.data;
                    this.myChart();
                }, err => {
                    alert('获取失败');
                })
            },

            // 分析界面
            fenxi() {

                this.color = ['noselect', 'noselect', 'noselect', 'select'],
                this.judge = {
                    kongzhi: false,
                    shuju: false,
                    guiji: false,
                    fenxi: true
                };
                axios({
                    method: 'GET',
                    url: '/manage/getOffCenterData'     // 舵机打角值接口
                }).then(response => {
                    if(response.data) {
                        this.coordinate1 = response.data;
                        this.myChart1.setOption({       // hhf：触发echart重绘
                            series: [{data: this.coordinate1}],
                        });
                    }
                }, err => {
                    alert('打角值获取失败')
                });

                axios({
                    method: 'GET',
                    url: '/manage/getMotorBiasData'    // 电机差值接口
                }).then(response => {
                    if(response.data) {
                        this.coordinate2 = response.data;
                        this.myChart2.setOption({      // hhf：触发echart重绘
                            series: [{data: this.coordinate2}],
                        });
                    }
                }, err => {
                    alert('电机差值获取失败')
                });
            },

        },

        mounted() {
            this.myChart = echarts.init(document.getElementById('plot'));
            this.option = {
                title: {
                    text: '运动轨迹',
                    left: 'center',
                    top: '10px'
                },
                tooltip: {
                    trigger: 'item',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                xAxis: {
                    type: 'value',
                    name: 'X轴',
                    nameLocation: 'middle',
                    nameTextStyle: {
                        fontWeight: 'bolder',
                        verticalAlign: 'top',
                        align: 'center',
                        fontSize: 16
                    }


                },
                yAxis: {
                    type: 'value',
                    name: 'Y轴',
                    nameLocation: 'middle',
                    nameTextStyle: {
                        fontWeight: 'bolder',
                        align: 'center',
                        verticalAlign: 'bottom',
                        fontSize: 16
                    }
                },
                series: [
                    {
                        symbolSize: 2,
                        data: this.coordinate,
                        // type: 'scatter'
                        type: 'line',
                        sampling:'lttb',
                        // smooth:'0.5'        // 平滑
                    }
                ],
                animation: false,
                toolbox:{
                    feature:{
                        saveAsImage:{
                            show:'true',
                            type:'png',
                            name:'轨迹'+(new Date())
                        },
                        dataZoom:{
                            show:'true',
                        }
                    }
                }
            };
            this.myChart.setOption(this.option);

            this.myChart1 = echarts.init(document.getElementById('plot1'));
            this.option1 = {
                title: {
                    text: '电感差值与舵机打角值关系图',
                    left: 'center',
                    top: '10px'
                },
                tooltip: {
                    trigger: 'item',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                xAxis: {
                    type: 'value',
                    name: '电感差值',
                    nameLocation: 'middle',
                    nameTextStyle: {
                        fontWeight: 'bolder',
                        verticalAlign: 'top',
                        align: 'center',
                        fontSize: 16
                    }

                },
                yAxis: {
                    type: 'value',
                    name: '舵机打角值',
                    nameLocation: 'middle',
                    nameTextStyle: {
                        fontWeight: 'bolder',
                        align: 'center',
                        verticalAlign: 'bottom',
                        fontSize: 16
                    }
                },
                series: [
                    {
                        symbolSize: 10,
                        data: this.coordinate1,
                        type: 'scatter'
                    }
                ],
                animation: false,
                toolbox:{
                    feature:{
                        saveAsImage:{
                            show:'true',
                            type:'png',
                            name:'电感差值与舵机打角值关系图'+(new Date())
                        },
                        dataZoom:{
                            show:'true',
                        }
                    }
                }
            };
            this.myChart1.setOption(this.option1);

            this.myChart2 = echarts.init(document.getElementById('plot2'));
            this.option2 = {
                title: {
                    text: '电感差值与左右电机差值关系图',
                    left: 'center',
                    top: '10px'
                },
                tooltip: {
                    trigger: 'item',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                xAxis: {
                    type: 'value',
                    name: '电感差值',
                    nameLocation: 'middle',
                    nameTextStyle: {
                        fontWeight: 'bolder',
                        verticalAlign: 'top',
                        align: 'center',
                        fontSize: 16
                    }

                },
                yAxis: {
                    type: 'value',
                    name: '左右电机差值的绝对值',
                    nameLocation: 'middle',
                    nameTextStyle: {
                        fontWeight: 'bolder',
                        align: 'center',
                        verticalAlign: 'bottom',
                        fontSize: 16
                    }
                },
                series: [
                    {
                        symbolSize: 10,
                        data: this.coordinate2,
                        type: 'scatter'
                    }
                ],
                animation: false,
                toolbox:{
                    feature:{
                        saveAsImage:{
                            show:'true',
                            type:'png',
                            name:'电感差值与左右电机差值关系图'+(new Date())
                        },
                        dataZoom:{
                            show:'true',
                        }
                    }
                }
            };
            this.myChart2.setOption(this.option2);
        }
    })
</script>
</body>


</html>